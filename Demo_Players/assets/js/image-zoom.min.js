!function($){"use strict";function b(){this._activeZoom=this._initialScrollPosition=this._initialTouchPosition=this._touchMoveListener=null,this._$document=$(document),this._$window=$(window),this._$body=$(document.body),this._boundClick=$.proxy(this._clickHandler,this)}function a(a){this._fullHeight=this._fullWidth=this._overlay=this._targetImageWrap=null,this._targetImage=a,this._$body=$(document.body)}b.prototype.listen=function(){this._$body.on("click",'[data-action="zoom"]',$.proxy(this._zoom,this))},b.prototype._zoom=function(b){var c=b.target;if(!(!c||"IMG"!=c.tagName||this._$body.hasClass("zoom-overlay-open"))){if(b.metaKey||b.ctrlKey)return window.open(b.target.getAttribute("data-original")||b.target.src,"_blank");!(c.width>=$(window).width()-a.OFFSET)&&(this._activeZoomClose(!0),this._activeZoom=new a(c),this._activeZoom.zoomImage(),this._$window.on("scroll.zoom",$.proxy(this._scrollHandler,this)),this._$document.on("keyup.zoom",$.proxy(this._keyHandler,this)),this._$document.on("touchstart.zoom",$.proxy(this._touchStart,this)),document.addEventListener?document.addEventListener("click",this._boundClick,!0):document.attachEvent("onclick",this._boundClick,!0),"bubbles"in b?b.bubbles&&b.stopPropagation():b.cancelBubble=!0)}},b.prototype._activeZoomClose=function(a){this._activeZoom&&(a?this._activeZoom.dispose():this._activeZoom.close(),this._$window.off(".zoom"),this._$document.off(".zoom"),document.removeEventListener("click",this._boundClick,!0),this._activeZoom=null)},b.prototype._scrollHandler=function(a){null===this._initialScrollPosition&&(this._initialScrollPosition=$(window).scrollTop()),Math.abs(this._initialScrollPosition-$(window).scrollTop())>=40&&this._activeZoomClose()},b.prototype._keyHandler=function(a){27==a.keyCode&&this._activeZoomClose()},b.prototype._clickHandler=function(a){a.preventDefault?a.preventDefault():event.returnValue=!1,"bubbles"in a?a.bubbles&&a.stopPropagation():a.cancelBubble=!0,this._activeZoomClose()},b.prototype._touchStart=function(a){this._initialTouchPosition=a.touches[0].pageY,$(a.target).on("touchmove.zoom",$.proxy(this._touchMove,this))},b.prototype._touchMove=function(a){Math.abs(a.touches[0].pageY-this._initialTouchPosition)>10&&(this._activeZoomClose(),$(a.target).off("touchmove.zoom"))},a.OFFSET=80,a._MAX_WIDTH=2560,a._MAX_HEIGHT=4096,a.prototype.zoomImage=function(){var a=document.createElement("img");a.onload=$.proxy(function(){this._fullHeight=Number(a.height),this._fullWidth=Number(a.width),this._zoomOriginal()},this),a.src=this._targetImage.src},a.prototype._zoomOriginal=function(){this._targetImageWrap=document.createElement("div"),this._targetImageWrap.className="zoom-img-wrap",this._targetImage.parentNode.insertBefore(this._targetImageWrap,this._targetImage),this._targetImageWrap.appendChild(this._targetImage),$(this._targetImage).addClass("zoom-img").attr("data-action","zoom-out"),this._overlay=document.createElement("div"),this._overlay.className="zoom-overlay",document.body.appendChild(this._overlay),this._calculateZoom(),this._triggerAnimation()},a.prototype._calculateZoom=function(){this._targetImage.offsetWidth;var b=this._fullWidth,c=this._fullHeight;$(window).scrollTop();var d=b/this._targetImage.width,e=$(window).height()-a.OFFSET,f=$(window).width()-a.OFFSET;b<f&&c<e?this._imgScaleFactor=d:b/c<f/e?this._imgScaleFactor=e/c*d:this._imgScaleFactor=f/b*d},a.prototype._triggerAnimation=function(){this._targetImage.offsetWidth;var c=$(this._targetImage).offset(),d=$(window).scrollTop()+$(window).height()/2,e=$(window).width()/2,f=c.top+this._targetImage.height/2,g=c.left+this._targetImage.width/2;this._translateY=d-f,this._translateX=e-g;var b="scale("+this._imgScaleFactor+")",a="translate("+this._translateX+"px, "+this._translateY+"px)";$.support.transition&&(a+=" translateZ(0)"),$(this._targetImage).css({"-webkit-transform":b,"-ms-transform":b,transform:b}),$(this._targetImageWrap).css({"-webkit-transform":a,"-ms-transform":a,transform:a}),this._$body.addClass("zoom-overlay-open")},a.prototype.close=function(){if(this._$body.removeClass("zoom-overlay-open").addClass("zoom-overlay-transitioning"),$(this._targetImage).css({"-webkit-transform":"","-ms-transform":"",transform:""}),$(this._targetImageWrap).css({"-webkit-transform":"","-ms-transform":"",transform:""}),!$.support.transition)return this.dispose();$(this._targetImage).one($.support.transition.end,$.proxy(this.dispose,this)).emulateTransitionEnd(300)},a.prototype.dispose=function(){this._targetImageWrap&&this._targetImageWrap.parentNode&&($(this._targetImage).removeClass("zoom-img").attr("data-action","zoom"),this._targetImageWrap.parentNode.replaceChild(this._targetImage,this._targetImageWrap),this._overlay.parentNode.removeChild(this._overlay),this._$body.removeClass("zoom-overlay-transitioning"))},$(function(){new b().listen()})}(jQuery)